<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>XMLHttpRequest #01</title>
  <link rel="stylesheet" href="css/estilo.css">
</head>
<body class="conteudo exercicio">
  <h1>Estados</h1>

  <script>
    // Função AJAX
    function ajax(config) {
      const xhr = new XMLHttpRequest()

      xhr.open(config.metodo, config.url, true)
      xhr.onload = e => {  //function que será executada quando a requisição terminar
        if (xhr.status === 200) {//verifica  se o status do HTTP é 200 ('Req. bem sucedida')
          config.sucesso(xhr.response)//req. bem sucedida chama config.sucesso e passa a resposta da requisição
        } else if (xhr.status >= 400) {//se o status for 400 ou maior significa algum tipo de erro,chama config.erro e informa o n° do status e o texto.
          config.erro({
            codigo: xhr.status,
            texto: xhr.statusText
          })
        }
      }

      xhr.send() //dispara a requisição feita pelo objeto XMLHttpRequest
    }

    // Função para criar tabela
    function criarTabela(estados) {
      const linhas = estados.map(estado => {
        const tdId = document.createElement('td')// coluna da linha
        tdId.innerHTML = estado.id

        const tdNome = document.createElement('td')//coluna da linha
        tdNome.innerHTML = estado.nome

        const tdSigla = document.createElement('td')
        tdSigla.innerHTML = estado.sigla

        const tr = document.createElement('tr')
        tr.appendChild(tdId)
        tr.appendChild(tdNome)
        tr.appendChild(tdSigla)

        return tr
      })

      const tabela = document.createElement('table')
      linhas.forEach(linha => tabela.appendChild(linha))

      document.body.appendChild(tabela)
    }

    // Chamada da função AJAX
    ajax({
      url: 'dados/estados.json',
      metodo: 'GET',
      sucesso(resposta) {
        const estados = JSON.parse(resposta)
        criarTabela(estados)
      },
      erro(e) {
        const msg = document.createTextNode(`${e.codigo} : ${e.texto}`)
        document.body.appendChild(msg)
      }
    })
  </script>
</body>
</html>